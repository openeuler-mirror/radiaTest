server {
    listen       8080 default_server;
    listen       [::]:8080 ;
    server_name  radiatest.openeuler.org;

    add_header X-XSS-Protection "1;mode=block";
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header Strict-Transport-Security "max-age=31536000;includeSubDomains";
    add_header Content-Security-Policy "default-src 'self'";
    add_header Cache-control "no-cache,no-store,must-revalidate";
    add_header Pragma no-cache;
    add_header Expires 0;

	location ~ ^(?:(?!/static)).*\.(js|css|ico|png|jpg|eot|svg|ttf|woff|html|txt|pdf)$ {
		root /opt/radiaTest/radiaTest-web/dist;
		expires 30d;
	}

	location / {
		try_files $request_uri /index.html;
		if (!-e $request_filename){
			rewrite ^(.*)$ /index.html last;
		}
	}

	location /api {
		limit_req zone=basic_req_limit burst=10;
		limit_conn basic_conn_limit 10;
		proxy_pass http://supervisor-service.radia-test.svc.cluster.local:21500;
		proxy_set_header X-Real-Ip $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_read_timeout 1800;
	}

	location /static {
		limit_req zone=basic_req_limit burst=5;
		limit_conn basic_conn_limit 10;
		proxy_pass http://supervisor-service.radia-test.svc.cluster.local:21500;
		proxy_set_header X-Real-Ip $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}

	location ^~/socket.io {
		include uwsgi_params;
		proxy_pass http://supervisor-service.radia-test.svc.cluster.local:21500;
		proxy_set_header Host $host;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_read_timeout 600s;
		proxy_connect_timeout 600s;
		proxy_send_timeout 600s;

		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
	}

	error_page 401 /401.html;
	location = /401.html {
	}

	error_page 404 /404.html;
	location = /404.html {
	}

	error_page 500 502 503 504 /50x.html;
	location = /50x.html {
	}
}